import os
import platform
import subprocess

levelZeroProbe = os.path.join('pmlc/rt/level_zero/level_zero_probe')
if platform.system() == 'Windows':
    levelZeroProbe += '.exe'

if not os.path.exists(levelZeroProbe):
    config.unsupported = True
else:
    proc = subprocess.run(levelZeroProbe, capture_output=True, text=True)
    if proc.returncode:
        config.unsupported = True
    elif "No supported LevelZero devices available" in proc.stdout:
        config.unsupported = True
